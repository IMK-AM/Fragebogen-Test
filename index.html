<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Was bin ich für ein Emotionstyp?</title>
  <meta name="description" content="Online-Fragebogen mit 48 Items zu vier Emotionsfeldern – mit Sofortauswertung und CSV-Export."/>
  <style>
    :root { --ink:#111827; --muted:#6b7280; --brand:#2563eb; --bg:#ffffff; --card:#ffffff; --line:#e5e7eb; }
    html,body { margin:0; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; }
    .container { max-width: 980px; margin: 36px auto; padding: 0 18px; }
    .header { margin-bottom: 16px; }
    h1 { font-size: clamp(22px, 3.2vw, 32px); margin:0 0 6px; }
    p.lead { color: var(--muted); margin:0 0 20px; }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: 14px; padding: 18px; }
    .top { display:flex; gap:12px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .pid { display:flex; gap:10px; align-items:center; }
    .pid input { border:1px solid var(--line); border-radius: 10px; padding:8px 10px; width:220px; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; }
    button { appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink); padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:600; }
    button.primary { background: var(--brand); color: #fff; border-color: var(--brand); }
    .item { border:1px solid var(--line); border-radius:12px; padding:12px; }
    .item h3 { margin:0 0 8px; font-size: 16px; }
    .grid { display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 760px) { .grid { grid-template-columns: 1fr 1fr; } }
    .scale { display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    .scale label { display:grid; place-items:center; width:44px; height:44px; border:1px solid var(--line); border-radius:10px; cursor:pointer; }
    .scale input { display:none; }
    .scale input:checked + span { outline: 2px solid var(--brand); box-shadow: 0 0 0 4px rgba(37,99,235,.12) inset; }
    .legend { display:flex; justify-content:space-between; color:var(--muted); font-size:12px; margin-top:6px; }
    .result { border:1px dashed var(--line); border-radius:12px; padding:14px; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { border-top:1px solid var(--line); padding:10px 6px; text-align:left; }
    .muted { color: var(--muted); }
    footer { color:var(--muted); font-size:12px; margin-top: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Was bin ich für ein Emotionstyp?</h1>
      <p class="lead">Bitte beantworten Sie die nachfolgenden Fragen, inwieweit die jeweiligen Statements auf Sie zutreffen auf der Skala von 1=trifft zu bis 5=trifft nicht zu:</p>
    </div>
    <div class="card">
      <div class="top">
        <div class="pid">
          <label for="pid" class="muted">Teilnehmenden‑Code (optional):</label>
          <input id="pid" name="pid" placeholder="z. B. T01, AB07" />
        </div>
        <div class="actions">
          <button id="shuffleBtn" type="button" title="Fragen neu mischen">Neu mischen</button>
          <button id="resetBtn" type="button">Zurücksetzen</button>
        </div>
      </div>

      <form id="form" style="margin-top:12px;">
        <div id="questions" class="grid"></div>
        <div class="actions" style="margin-top:12px;">
          <button class="primary" type="submit">Auswerten</button>
          <button id="downloadBtn" type="button" title="Antworten + Auswertung als CSV speichern">CSV herunterladen</button>
        </div>
      </form>

      <div id="result" class="result" style="display:none; margin-top:16px;">
        <h2 style="margin:0 0 6px;">Auswertung</h2>
        <p class="muted" style="margin:0 0 8px;">Die Werte werden pro Emotionsfeld berechnet. Skala: 1 = trifft zu, 5 = trifft nicht zu (intern invertiert).</p>
        <table class="table">
          <thead><tr><th>Emotionsfeld</th><th>Summe (12–60)</th><th>Einstufung</th></tr></thead>
          <tbody id="resBody"></tbody>
        </table>
      </div>

      <footer>Weißer Hintergrund, keine Datenspeicherung auf dem Server. © 2025</footer>
    </div>
  </div>

<script>
const ITEMS = [{"id": 1, "text": "Ich mache mir oft Gedanken über mögliche Gefahren oder Risiken.", "field": "Angst/Sorge"}, {"id": 2, "text": "Ich neige dazu, mir über die Zukunft Sorgen zu machen.", "field": "Angst/Sorge"}, {"id": 3, "text": "Wenn ein Problem auftaucht, denke ich zuerst an das Schlimmste.", "field": "Angst/Sorge"}, {"id": 4, "text": "Ich habe häufig das Gefühl, nicht genügend vorbereitet zu sein.", "field": "Angst/Sorge"}, {"id": 5, "text": "Ich vermeide Situationen, die mir unbekannt, unsicher oder riskant erscheinen.", "field": "Angst/Sorge"}, {"id": 6, "text": "Körperliche Anspannung (z. B. Herzklopfen) begleitet oft meine Sorgen.", "field": "Angst/Sorge"}, {"id": 7, "text": "Ich grüble lange über Entscheidungen nach, bevor ich handle.", "field": "Angst/Sorge"}, {"id": 8, "text": "Ich bin sehr empfindlich gegenüber unerwarteten Veränderungen.", "field": "Angst/Sorge"}, {"id": 9, "text": "In sozialen Situationen mache ich mir viele Gedanken darüber, was andere über mich denken.", "field": "Angst/Sorge"}, {"id": 10, "text": "Selbst kleine Fehler können mich lange beschäftigen.", "field": "Angst/Sorge"}, {"id": 11, "text": "Ich habe Schwierigkeiten, mich zu entspannen, wenn Dinge unklar sind.", "field": "Angst/Sorge"}, {"id": 12, "text": "Ich ziehe es vor, Pläne detailliert zu machen, um Risiken zu vermeiden.", "field": "Angst/Sorge"}, {"id": 13, "text": "Wenn mich jemand kritisiert, reagiere ich schnell gereizt.", "field": "Ärger/Wut"}, {"id": 14, "text": "Ich habe oft das Bedürfnis, meinen Ärger direkt auszudrücken.", "field": "Ärger/Wut"}, {"id": 15, "text": "Wenn ich mich unfair behandelt fühle, fällt es mir schwer, ruhig zu bleiben.", "field": "Ärger/Wut"}, {"id": 16, "text": "Kleine Ärgernisse bringen mich manchmal schnell aus der Fassung.", "field": "Ärger/Wut"}, {"id": 17, "text": "Ich neige dazu, laut zu werden, wenn ich mich ärgere.", "field": "Ärger/Wut"}, {"id": 18, "text": "Ich kann mich lange über Fehlverhalten anderer ärgern.", "field": "Ärger/Wut"}, {"id": 19, "text": "Ich empfinde Ärger oft körperlich (z. B. Muskelanspannung, erhöhter Puls).", "field": "Ärger/Wut"}, {"id": 20, "text": "Wenn ich etwas als respektlos empfinde, reagiere ich stark.", "field": "Ärger/Wut"}, {"id": 21, "text": "Ich neige zu impulsivem Handeln, wenn ich wütend bin.", "field": "Ärger/Wut"}, {"id": 22, "text": "Mein Ärger kann mich manchmal noch Tage später beschäftigen.", "field": "Ärger/Wut"}, {"id": 23, "text": "Ich habe Schwierigkeiten, anderen zu verzeihen, wenn sie mich verletzt haben.", "field": "Ärger/Wut"}, {"id": 24, "text": "Ich neige dazu, im Ärger schnell Schuldige zu suchen.", "field": "Ärger/Wut"}, {"id": 25, "text": "Ich bin schnell niedergeschlagen, wenn Dinge nicht wie geplant laufen.", "field": "Enttäuschung/Trauer"}, {"id": 26, "text": "Ich empfinde oft Wehmut über vergangene Erlebnisse.", "field": "Enttäuschung/Trauer"}, {"id": 27, "text": "Rückschläge lassen mich lange nicht los.", "field": "Enttäuschung/Trauer"}, {"id": 28, "text": "Ich fühle mich manchmal wertlos, wenn ich ein Ziel nicht erreiche.", "field": "Enttäuschung/Trauer"}, {"id": 29, "text": "Traurige Erlebnisse anderer berühren mich stark.", "field": "Enttäuschung/Trauer"}, {"id": 30, "text": "Ich neige dazu, mich zurückzuziehen, wenn ich enttäuscht bin.", "field": "Enttäuschung/Trauer"}, {"id": 31, "text": "Ich empfinde häufig eine gewisse Melancholie ohne erkennbaren Grund.", "field": "Enttäuschung/Trauer"}, {"id": 32, "text": "Ich denke oft an verpasste Chancen.", "field": "Enttäuschung/Trauer"}, {"id": 33, "text": "Nach Enttäuschungen brauche ich lange, um wieder motiviert zu sein.", "field": "Enttäuschung/Trauer"}, {"id": 34, "text": "Wenn ich traurig bin, verliere ich leicht den Antrieb.", "field": "Enttäuschung/Trauer"}, {"id": 35, "text": "Ich habe das Gefühl, dass ich Verluste besonders intensiv erlebe.", "field": "Enttäuschung/Trauer"}, {"id": 36, "text": "Ich neige dazu, Situationen pessimistisch zu betrachten, wenn ich enttäuscht bin.", "field": "Enttäuschung/Trauer"}, {"id": 37, "text": "Ich vergleiche mich oft mit anderen.", "field": "Neid/Eifersucht"}, {"id": 38, "text": "Wenn jemand anderes Erfolg hat, fühle ich mich manchmal minderwertig.", "field": "Neid/Eifersucht"}, {"id": 39, "text": "Ich ärgere mich, wenn andere Dinge haben, die ich nicht habe.", "field": "Neid/Eifersucht"}, {"id": 40, "text": "Ich verspüre häufig das Bedürfnis, mit anderen mitzuhalten.", "field": "Neid/Eifersucht"}, {"id": 41, "text": "Ich neige dazu, mich unzufrieden zu fühlen, wenn andere gelobt werden.", "field": "Neid/Eifersucht"}, {"id": 42, "text": "Wenn jemand meinem Partner nahekommt, fühle ich mich unwohl.", "field": "Neid/Eifersucht"}, {"id": 43, "text": "Ich achte stark darauf, was andere besitzen oder erreichen.", "field": "Neid/Eifersucht"}, {"id": 44, "text": "Es fällt mir schwer, mich uneingeschränkt für den Erfolg anderer zu freuen.", "field": "Neid/Eifersucht"}, {"id": 45, "text": "Ich verspüre manchmal den Wunsch, anderen etwas nicht zu gönnen.", "field": "Neid/Eifersucht"}, {"id": 46, "text": "Ich habe Angst, wichtige Beziehungen an andere zu verlieren.", "field": "Neid/Eifersucht"}, {"id": 47, "text": "Ich ertappe mich dabei, dass ich andere manchmal als Konkurrenten sehe.", "field": "Neid/Eifersucht"}, {"id": 48, "text": "Ich bin sehr schnell eifersüchtig.", "field": "Neid/Eifersucht"}];

function shuffle(array) { 
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1)); 
    [array[i], array[j]] = [array[j], array[i]]; 
  }
  return array;
}

const FIELDS = ["Angst/Sorge", "Ärger/Wut", "Enttäuschung/Trauer", "Neid/Eifersucht"];
const FIELD_ORDER = FIELDS.slice();

const qsWrap = document.getElementById('questions');
const form = document.getElementById('form');

function render(items) { 
  qsWrap.innerHTML = "";
  items.forEach((it, idx) => {
    const name = `q_${idx+1}`;
    const card = document.createElement('div');
    card.className = 'item';
    const h3 = document.createElement('h3');
    h3.textContent = `${idx+1}. ${it.text}`;
    card.appendChild(h3);

    const scale = document.createElement('div');
    scale.className = 'scale';
    for (let v = 1; v <= 5; v++) {
      const label = document.createElement('label');
      const input = document.createElement('input');
      input.type = 'radio'; input.name = name; input.value = v; input.required = true;
      const span = document.createElement('span'); span.textContent = v;
      label.appendChild(input); label.appendChild(span);
      scale.appendChild(label);
    }
    card.appendChild(scale);
    const legend = document.createElement('div');
    legend.className = 'legend';
    legend.innerHTML = '<span>1 = trifft zu</span><span>5 = trifft nicht zu</span>';
    card.appendChild(legend);

    const meta = document.createElement('input');
    meta.type = 'hidden'; meta.name = name+'_field'; meta.value = it.field;
    card.appendChild(meta);

    qsWrap.appendChild(card);
  });
}

let randomItems = shuffle(ITEMS.slice());
render(randomItems);

document.getElementById('shuffleBtn').addEventListener('click', () => {
  randomItems = shuffle(ITEMS.slice());
  render(randomItems);
  document.getElementById('result').style.display = 'none';
});

document.getElementById('resetBtn').addEventListener('click', () => {
  form.reset();
  document.getElementById('result').style.display = 'none';
});

function classify(sum) {
  if (sum >= 45) return "stark ausgeprägt";
  if (sum >= 29) return "mittel ausgeprägt";
  return "wenig ausgeprägt";
}

function compute() {
  const perField = {"Angst/Sorge":0, "Ärger/Wut":0, "Enttäuschung/Trauer":0, "Neid/Eifersucht":0};
  for (let i=0; i<randomItems.length; i++) {
    const name = `q_${i+1}`;
    const sel = document.querySelector(`input[name=${name}]:checked`);
    if (!sel) return null;
    const raw = Number(sel.value);
    const intensity = 6 - raw;
    const field = document.querySelector(`input[name=${name}_field]`).value;
    perField[field] += intensity;
  }
  return perField;
}

form.addEventListener('submit', (e) => {
  e.preventDefault();
  const perField = compute();
  if (!perField) return alert("Bitte alle Fragen beantworten.");
  const tbody = document.getElementById('resBody');
  tbody.innerHTML = "";
  FIELD_ORDER.forEach(f => {
    const tr = document.createElement('tr');
    const sum = perField[f];
    tr.innerHTML = `<td>${f}</td><td>${sum}</td><td>${classify(sum)}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('result').style.display = 'block';
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
});

function toCSV() {
  const header = ["timestamp","teilnehmenden_code"];
  const values = [new Date().toISOString(), (document.getElementById('pid').value||'').replace(/,/g,';')];
  for (let i=0; i<randomItems.length; i++) {
    header.push(`Q${i+1}_Antwort(1-5)`,`Q${i+1}_Feld`);
    const sel = document.querySelector(`input[name=q_${i+1}]:checked`);
    const field = document.querySelector(`input[name=q_${i+1}_field]`).value;
    values.push(sel ? sel.value : "");
    values.push(field);
  }
  header.push("Summe_Angst_Sorge","Klasse_Angst_Sorge","Summe_Aerger_Wut","Klasse_Aerger_Wut","Summe_Enttaeuschung_Trauer","Klasse_Enttaeuschung_Trauer","Summe_Neid_Eifersucht","Klasse_Neid_Eifersucht");
  const sums = compute();
  const row = values.concat([
    sums["Angst/Sorge"], classify(sums["Angst/Sorge"]),
    sums["Ärger/Wut"], classify(sums["Ärger/Wut"]),
    sums["Enttäuschung/Trauer"], classify(sums["Enttäuschung/Trauer"]),
    sums["Neid/Eifersucht"], classify(sums["Neid/Eifersucht"])
  ]);
  return header.join(",") + "\n" + row.join(",");
}

document.getElementById('downloadBtn').addEventListener('click', () => {
  const sums = compute();
  if (!sums) return alert("Bitte zuerst alle Fragen beantworten und auswerten.");
  const csv = toCSV();
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'emotionstyp_auswertung.csv';
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 2000);
});

const urlParams = new URLSearchParams(location.search);
const pidFromUrl = urlParams.get('pid');
if (pidFromUrl) document.getElementById('pid').value = pidFromUrl;
</script>
</body>
</html>
